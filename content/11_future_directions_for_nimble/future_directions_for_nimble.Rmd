---
title: "Future directions in NIMBLE development"
subtitle: "NIMBLE 2022 Lisbon Workshop"
author: "NIMBLE Development Team"
date: "June 2022"

output:
  slidy_presentation: default
  beamer_presentation: default
---
<style>
slides > slide {
  overflow-x: auto !important;
  overflow-y: auto !important;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Automatic differentiation

### Ways to get derivatives on a computer:

- finite element approximation: `(f(x + epsilon) - f(x)) / epsilon`
- symbolic (maybe from computer algebra): `(d/dx) exp(ax) = a* exp(ax)`
- AD: algorithmic or automatic differentiation: use new versions of "a", "x", and "exp" to track derivative information through `exp(ax)`.

### Successful uses of AD in statistical software:

- ADMB, which grew into TMB, which uses AD via CppAD package.
- Stan has its own AD system.
- PyMC, Tensorflow Probablity, numpyro and other packages are built around AD.

### NIMBLE implementation:

- Code-generate C++ for CppAD.
- This gives us access to multiple orders of derivatives
- We have implemented
    - Hamiltonian Monte Carlo: It works!
    - Langevin sampler: It works in principle, but at the moment seems not to mix well in many cases; more investigation needed.
    - Laplace approximation: It works!
    - Caveat: These are all complex methods and there is still some testing, debugging, and efficiency improvement to do.
- Capability to access derivatives for "arbitrary" (within sense) nimbleFunctions and for subsets of model calculations will enable a lot of flexible algorithm development.

We'll be doing a test release of this on a branch at `github.com/nimble-dev/nimble` for users to try out and give us feedback.

# nCompiler


The "NIMBLE compiler" has been very successful!

The "NIMBLE compiler" has many limitations!

We are re-designing the "NIMBLE compiler" from the ground up with some of the following goals:

- Be a stand-along R development tool.
- Clarify class / function programming concepts.
- Integrate with Rcpp more thoroughly.
- Support parallelization natively.
- Support saving / loading of compiled objects natively.
- Support automatic differentiation natively
- Generate R and C++ code into R package structure.
- Swap into NIMBLE in place of the current "NIMBLE compiler."

# Greater capability for domain-application packages

We want people to be able more easily to build R packages for specific types of models or methods.

- Custom MCMC configuration (works)
- Expansion / plug-in of model macros or modules

# Greater efficiency at various stages

- Faster model building and compilation 
- Reduced memory footprint
- Greater scalability
- Always, greater run-time efficiency!

We have prototype code for much faster (and reduced memory) handling of large models (those with many nodes).
